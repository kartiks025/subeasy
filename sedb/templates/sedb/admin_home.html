{% extends 'sedb/base.html' %}

{% block content %}
<div class="container">
    <input type="text" id="search"  placeholder="Search for names..">
  <div class="panel panel-default panel-table">
    <div class="panel-heading">
      <div class="row">
        <div class="col col-xs-6">
          <h3 class="panel-title">Courses</h3>
        </div>
        <div class="col col-xs-6 text-right">
          <button type="button" class="btn btn-sm btn-primary btn-create">Create New</button>
        </div>
      </div>
    </div>
    <div class="panel-body">
      <table class="table table-striped table-bordered table-list" id="course-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Course ID</th>
            <th>Course Name</th>
            <th>Delete</th>
          </tr>
        </thead>
          {% for c in courses %}
          <tr  class="course-row " data-toggle="collapse" href="#1{{ c.course_id }}">
            <td>{{ forloop.counter }}</td>
            <td>{{c.course_id}}</td>
            <td>{{c.name}}</td>
            <td><a class="delete-course btn btn-danger" id={{c.course_id}}><em class="fa fa-trash"></em></a></span></td>
          </tr>
          <tr id="1{{ c.course_id }}" class="collapse">
             <td colspan="4">
                 <div class="table-responsive" >
                     <table class="table">
                         {% for s in c.section %}
                         <tr>
                             <td>{{ forloop.counter }}</td>
                             <td>{{s.sec_name}}</td>
                             <td>{{s.semester}}</td>
                             <td>{{s.year}}</td>
                             <td><span class="delete-section glyphicon glyphicon-trash" id={{ s.sec_id }}></span>
                         </tr>
                         {% endfor %}
                         <tr>
                         <td colspan="4">
                           <form class="form-inline" action="add_section" method="post">{% csrf_token %}
                                   <input name="sec_name" type="text" class="form-control" placeholder="Section Name" required autofocus>
                                   <select class="year" name="year" placeholder="Year"></select>
                                   <select name="semester" placeholder="Semester" required>
                                     <option value="Fall">Fall</option>
                                     <option value="Spring">Spring</option>
                                     <option value="Summer">Summer</option>
                                     <option value="Winter">Winter</option>
                                   </select>
                                   <input type="hidden" name="course_id" value="{{c.course_id}}">
                                   <button class="btn btn-lg btn-primary" type="submit">Add Section</button>
                           </form>
                           </td>
                          </tr>
                     </table>

                 </div>
             </td>
          </tr>
          {% endfor %}
      </table>
    </div>
    <form class="form-inline" action="add_course" method="post">{% csrf_token %}
            <input name="course_id" type="text" class="form-control" placeholder="Course ID" required autofocus>
            <input name="name" type="text" class="form-control" placeholder="Coure Name" required>
            <button class="btn btn-lg btn-primary" type="submit">Add Course</button>
    </form>
    
</div>
{% endblock %}

{% block javascript %}
  <script>
    $(".delete-course").click(function () {
      var course_id = $(this).attr('id');
      $.ajax({
        method: "POST",
        url: '/sedb/delete_course',
        data: {
          'course_id': course_id,
        },
        dataType: 'json',
        success: function (data) {
          if(data.success){
              location.reload();
          }
        }
      });
    });
    $(".delete-section").click(function () {
      var section_id = $(this).attr('id');
      $.ajax({
        method: "POST",
        url: '/sedb/delete_section',
        data: {
          'sec_id': section_id,
        },
        dataType: 'json',
        success: function (data) {
          if(data.success){
              location.reload();
          }
        }
      });
    });
    $(function() {
        var start = 2000;
        var end = new Date().getFullYear()+1;
        var options = "";
        for(var year = start ; year <=end; year++){
          options += "<option>"+ year +"</option>";
        }
        $('.year').html(options);
    });
    $("#search").on("keyup", function() {
        var value = $(this).val();
        $(".course-row").each(function(index) {
            $row = $(this);

            var id = $row.find("td:nth-child(2)").text();
            var id1 = $row.find("td:nth-child(3)").text();
            console.log(id);
            console.log(id1);

            if (id.indexOf(value) !== 0 && id1.indexOf(value) !== 0) {
                $row.hide();
            }
            else if ($row.is('.collapse:not(.show)')) {
              $row.collapse();
            }
            else {
                $row.show();
            }
        });
    });
  </script>
{% endblock %}

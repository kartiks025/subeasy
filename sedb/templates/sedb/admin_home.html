{% extends 'sedb/base.html' %}

{% block content %}
<div class="container">
    <i class="material-icons prefix">search</i><input type="text" id="search"  placeholder="Search for names..">
    <ul class="collapsible popout" data-collapsible="accordion">
          {% for c in courses %}
          <li class="course-row">
          <div class="collapsible-header row"><i class="material-icons">label</i>
            {{c.course_id}}-{{c.name}}
            <a class="delete-course" id={{c.course_id}}><i class="material-icons teal-text">delete</i></em></a>
          </div>
          <div class="collapsible-body container">
            <div class="row col s12">
              <div class="table-responsive" >
                  <table class="centered highlight bordered">
                      {% for s in c.section %}
                      <tr>
                          <td>{{ forloop.counter }}</td>
                          <td>{{s.sec_name}}</td>
                          <td>{{s.semester}}</td>
                          <td>{{s.year}}</td>
                          <td><a class="delete-section" id={{s.sec_id}}><i class="material-icons teal-text" style="font-size: 20px">delete</i></a></td>
                      </tr>
                      {% endfor %}
                  </table>
              </div>
              <form class="col l12" action="add_section" method="post">{% csrf_token %}
                      <div class='input-field col l6'><input name="sec_name" type="text" class="form-control" placeholder="Section Name" required autofocus></div>
                      <div class='input-field col l6'><select class="year browser-default" name="year" placeholder="Year"></select></div>
                      <div class='input-field col l3 offser-l2' align="left"><select class="browser-default" name="semester" placeholder="Semester" required>
                        <option value="Fall">Fall</option>
                        <option value="Spring">Spring</option>
                        <option value="Summer">Summer</option>
                        <option value="Winter">Winter</option>
                      </select></div>
                      <div class='input-field col l6'><input name="course_id" type="text" value="{{c.course_id}}" class="form-control"></div>
                      <div class='input-field col l6'><button class="btn btn-lg btn-primary" type="submit">Add Section</button></div>
              </form>
            </div>
          </div>
          {% endfor %}
         <li>
          <div class="collapsible-header"><i class="material-icons">add</i>Add New Course</div>
          <div class="collapsible-body">
          <div class="container">
              <form class="form-inline" action="add_course" method="post">{% csrf_token %}
                      <input name="course_id" type="text" class="form-control" placeholder="Course ID" required autofocus>
                      <input name="name" type="text" class="form-control" placeholder="Coure Name" required>
                      <button class="btn btn-lg btn-primary" type="submit">Add Course</button>
              </form>
          </div>
          </div>
          </li>
    </ul> 
</div>
{% endblock %}

{% block javascript %}
  <script>
    $(".delete-course").click(function () {
      var course_id = $(this).attr('id');
      $.ajax({
        method: "POST",
        url: '/sedb/delete_course',
        data: {
          'course_id': course_id,
        },
        dataType: 'json',
        success: function (data) {
          if(data.success){
              location.reload();
          }
        }
      });
    });
    $(".delete-section").click(function () {
      var section_id = $(this).attr('id');
      $.ajax({
        method: "POST",
        url: '/sedb/delete_section',
        data: {
          'sec_id': section_id,
        },
        dataType: 'json',
        success: function (data) {
          if(data.success){
              location.reload();
          }
        }
      });
    });
    $(function() {
        var start = 2000;
        var end = new Date().getFullYear()+1;
        var options = "";
        for(var year = start ; year <=end; year++){
          options += "<option>"+ year +"</option>";
        }
        $('.year').html(options);
    });
    $("#search").on("keyup", function() {
        var value = $(this).val();
        $(".course-row").each(function(index) {
            $row = $(this);

            var id = $row.find("td:nth-child(2)").text();
            var id1 = $row.find("td:nth-child(3)").text();
            console.log(id);
            console.log(id1);

            if (id.indexOf(value) !== 0 && id1.indexOf(value) !== 0) {
                $row.hide();
            }
            else if ($row.is('.collapse:not(.show)')) {
              $row.collapse();
            }
            else {
                $row.show();
            }
        });
    });
    $(document).ready(function() {
        $('select').material_select();
    });
  </script>
{% endblock %}
